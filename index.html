<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trading Suite | Professional Calculator Tools</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%231e90ff'/%3E%3Cstop offset='100%25' style='stop-color:%2300d4ff'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='%23181a20'/%3E%3Cpath d='M25,70 L35,55 L45,60 L55,40 L65,45 L75,25' stroke='url(%23g)' stroke-width='5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Ccircle cx='75' cy='25' r='5' fill='%2302c076'/%3E%3Cpath d='M70,30 L75,25 L80,30' stroke='%2302c076' stroke-width='2.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%231e90ff'/%3E%3Cstop offset='100%25' style='stop-color:%2300d4ff'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='%23181a20'/%3E%3Cpath d='M25,70 L35,55 L45,60 L55,40 L65,45 L75,25' stroke='url(%23g)' stroke-width='5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Ccircle cx='75' cy='25' r='5' fill='%2302c076'/%3E%3Cpath d='M70,30 L75,25 L80,30' stroke='%2302c076' stroke-width='2.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"
    />
    <meta name="theme-color" content="#0b0e11" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg-main: #0b0e11;
        --bg-card: #181a20;
        --bg-sidebar: #13161c;
        --accent-blue: #2f80ed;
        --accent-red: #f84960;
        --accent-green: #02c076;
        --accent-orange: #f39c12;
        --accent-purple: #9b59b6;
        --border-color: #2b2f36;
        --text-muted: #848e9c;
        --input-bg: #1e222a;
        --sidebar-width: 280px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background-color: var(--bg-main);
        color: #eaecef;
        font-family: "Inter", sans-serif;
        overflow-x: hidden;
      }

      /* Sidebar Navigation */
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        width: var(--sidebar-width);
        height: 100vh;
        background: var(--bg-sidebar);
        border-right: 1px solid var(--border-color);
        padding: 30px 0;
        z-index: 1000;
        transition: transform 0.3s ease;
      }

      .sidebar-header {
        padding: 0 25px 25px 25px;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 20px;
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
      }

      .logo-icon {
        width: 42px;
        height: 42px;
        flex-shrink: 0;
      }

      .sidebar-header h1 {
        font-size: 1.4rem;
        font-weight: 800;
        color: #fff;
        margin-bottom: 0;
      }

      .sidebar-header p {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin: 0;
        padding-left: 10px;
        padding-right: 10px;
        white-space: nowrap;
        width: 100%;
      }

      .nav-menu {
        list-style: none;
        padding: 0 15px;
      }

      .nav-item {
        margin-bottom: 8px;
      }

      .nav-link-custom {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 15px;
        color: var(--text-muted);
        text-decoration: none;
        border-radius: 10px;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        border: 1px solid transparent;
      }

      .nav-link-custom:hover {
        background: rgba(47, 128, 237, 0.1);
        color: var(--accent-blue);
        border-color: rgba(47, 128, 237, 0.2);
      }

      .nav-link-custom.active {
        background: linear-gradient(
          135deg,
          rgba(47, 128, 237, 0.15) 0%,
          rgba(47, 128, 237, 0.05) 100%
        );
        color: var(--accent-blue);
        border-color: var(--accent-blue);
      }

      .nav-link-custom i {
        font-size: 1.2rem;
        width: 24px;
        text-align: center;
      }

      .nav-link-custom img {
        width: 24px;
        height: 24px;
        object-fit: contain;
      }

      /* Mobile Menu Toggle */
      .menu-toggle {
        display: none;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background: var(--bg-sidebar);
        border: 1px solid var(--border-color);
        color: #fff;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.2rem;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      .menu-toggle.hide {
        transform: translateY(-80px);
        opacity: 0;
      }

      /* Mobile Overlay */
      .mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      .mobile-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      /* Main Content Area */
      .main-content {
        margin-left: var(--sidebar-width);
        padding: 40px 60px;
        min-height: 100vh;
        max-width: 1400px;
      }

      .page-header {
        margin-bottom: 30px;
        animation: fadeInDown 0.5s ease 0.1s backwards;
      }

      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .page-header h2 {
        font-size: 2rem;
        font-weight: 800;
        color: #fff;
        margin-bottom: 8px;
      }

      .page-header p {
        font-size: 1rem;
        color: var(--text-muted);
      }

      /* Calculator Card */
      .calc-card {
        background-color: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 25px;
        animation: fadeInUp 0.5s ease 0.2s backwards;
      }

      /* Form Styling */
      .form-label {
        color: var(--text-muted);
        font-weight: 600;
        font-size: 0.875rem;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .form-control,
      .form-select {
        background-color: var(--input-bg);
        border: 1px solid var(--border-color);
        color: #fff;
        border-radius: 10px;
        padding: 12px 16px;
        font-size: 0.95rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .form-control:focus,
      .form-select:focus {
        background-color: var(--input-bg);
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(47, 128, 237, 0.1);
        color: #fff;
        transform: translateY(-2px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .input-group-text {
        background-color: var(--input-bg);
        border: 1px solid var(--border-color);
        color: #fff;
      }

      .form-check-input {
        background-color: var(--bg-main);
        border: 1px solid var(--border-color);
        cursor: pointer;
      }

      /* Result Rows */
      .res-row {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
        padding: 16px 24px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 4px solid transparent;
        transition: all 0.2s ease;
      }

      .res-row:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .res-row.tp {
        border-left-color: var(--accent-green);
      }
      .res-row.pos {
        border-left-color: var(--accent-blue);
      }
      .res-row.risk {
        border-left-color: var(--accent-red);
      }

      .highlight-r {
        color: var(--accent-orange);
        font-weight: 700;
      }
      .highlight-pct {
        color: var(--accent-orange);
        font-weight: 600;
      }
      .scaling-box {
        text-align: right;
      }

      /* Profit Box */
      .total-profit-box {
        background: linear-gradient(135deg, #02a163 0%, #02c076 100%);
        border-radius: 14px;
        padding: 24px;
        margin: 25px 0;
        display: flex;
        justify-content: space-around;
        align-items: center;
        box-shadow: 0 6px 20px rgba(2, 192, 118, 0.25);
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      .profit-item {
        text-align: center;
      }
      .profit-label {
        display: block;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 1.2px;
        color: rgba(255, 255, 255, 0.85) !important;
        font-weight: 600;
        margin-bottom: 6px;
      }

      .profit-value {
        display: block;
        font-size: 1.6rem;
        font-weight: 800;
        color: #ffffff !important;
      }

      .profit-divider {
        width: 2px;
        height: 50px;
        background: rgba(255, 255, 255, 0.25);
      }

      /* Compounding Calculator Specific */
      .compound-options {
        display: flex;
        gap: 12px;
        margin-bottom: 25px;
      }

      .option-btn {
        flex: 1;
        padding: 20px 16px;
        background: var(--input-bg);
        border: 2px solid var(--border-color);
        border-radius: 14px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .option-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          135deg,
          rgba(47, 128, 237, 0.15) 0%,
          rgba(47, 128, 237, 0.05) 100%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .option-btn:hover {
        border-color: var(--accent-blue);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(47, 128, 237, 0.2);
      }

      .option-btn:hover::before {
        opacity: 0.5;
      }

      .option-btn.active {
        border-color: var(--accent-blue);
        background: linear-gradient(
          135deg,
          rgba(47, 128, 237, 0.25) 0%,
          rgba(47, 128, 237, 0.15) 100%
        );
        box-shadow: 0 6px 20px rgba(47, 128, 237, 0.3);
      }

      .option-btn.active::before {
        opacity: 1;
      }

      .option-btn input[type="radio"] {
        display: none;
      }

      .option-btn label {
        cursor: pointer;
        display: block;
        font-weight: 700;
        font-size: 1.2rem;
        color: var(--text-muted);
        margin: 0;
        position: relative;
        z-index: 1;
        transition: all 0.3s ease;
      }

      .option-btn.active label {
        color: var(--accent-blue);
        transform: scale(1.05);
      }

      .option-btn small {
        display: block;
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-top: 6px;
        position: relative;
        z-index: 1;
      }

      .option-btn.active small {
        color: rgba(47, 128, 237, 0.8);
      }

      .chart-container {
        position: relative;
        height: 350px;
        margin: 25px 0;
        padding: 20px;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 12px;
        border: 1px solid var(--border-color);
        animation: scaleIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) 0.3s backwards;
      }

      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .chart-loading {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(24, 26, 32, 0.98);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        z-index: 10;
        backdrop-filter: blur(4px);
      }

      .spinner-wrapper {
        position: relative;
        width: 60px;
        height: 60px;
        margin-bottom: 15px;
      }

      .chart-loading .loader-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(47, 128, 237, 0.2);
        border-top-color: var(--accent-blue);
        border-radius: 50%;
        animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        position: relative;
        z-index: 2;
      }

      .spinner-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        background: radial-gradient(
          circle,
          rgba(47, 128, 237, 0.3) 0%,
          transparent 70%
        );
        border-radius: 50%;
        animation: pulse-glow 1.5s ease-in-out infinite;
        z-index: 1;
      }

      .chart-loading .loader-text {
        color: var(--accent-blue);
        font-weight: 600;
        font-size: 0.95rem;
        letter-spacing: 0.5px;
        animation: fade-pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse-glow {
        0%,
        100% {
          opacity: 0.3;
          transform: translate(-50%, -50%) scale(0.9);
        }
        50% {
          opacity: 0.6;
          transform: translate(-50%, -50%) scale(1.1);
        }
      }

      @keyframes fade-pulse {
        0%,
        100% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
      }

      .data-table-container {
        max-height: 400px;
        overflow-y: auto;
        overflow-x: hidden;
        margin: 25px 0;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 12px;
        border: 1px solid var(--border-color);
        scrollbar-width: thin;
        scrollbar-color: var(--accent-blue) var(--bg-card);
        animation: fadeInUp 0.5s ease 0.5s backwards;
      }

      /* Webkit browsers (Chrome, Safari, Edge) */
      .data-table-container::-webkit-scrollbar {
        width: 8px;
      }

      .data-table-container::-webkit-scrollbar-track {
        background: var(--bg-card);
        border-radius: 10px;
      }

      .data-table-container::-webkit-scrollbar-thumb {
        background: var(--accent-blue);
        border-radius: 10px;
      }

      .data-table-container::-webkit-scrollbar-thumb:hover {
        background: #4a9aef;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }

      .data-table thead {
        position: sticky;
        top: 0;
        background: var(--bg-card);
        z-index: 10;
      }

      .data-table th,
      .data-table td {
        padding: 14px 16px;
        font-size: 0.9rem;
      }

      .data-table th {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--text-muted);
        font-weight: 600;
        border-bottom: 2px solid var(--border-color);
      }

      /* Column widths and alignment */
      .data-table th:nth-child(1),
      .data-table td:nth-child(1) {
        width: 20%;
        text-align: left;
      }

      .data-table th:nth-child(2),
      .data-table td:nth-child(2) {
        width: 25%;
        text-align: right;
      }

      .data-table th:nth-child(3),
      .data-table td:nth-child(3) {
        width: 25%;
        text-align: right;
      }

      .data-table th:nth-child(4),
      .data-table td:nth-child(4) {
        width: 30%;
        text-align: right;
      }

      .data-table td {
        border-bottom: 1px solid rgba(43, 47, 54, 0.5);
      }

      .data-table tbody tr {
        animation: fadeInRow 0.3s ease forwards;
        opacity: 0;
        transition: background 0.2s ease;
      }

      @keyframes fadeInRow {
        to {
          opacity: 1;
        }
      }

      .data-table tbody tr:hover {
        background: rgba(47, 128, 237, 0.1);
      }

      .data-table tbody tr:hover td:first-child {
        box-shadow: inset 3px 0 0 var(--accent-blue);
      }

      .data-table .period-col {
        color: var(--text-muted);
        font-weight: 600;
      }

      .data-table .balance-col {
        color: #9ca3af;
        font-weight: 600;
      }

      .data-table .profit-col {
        color: var(--accent-blue);
      }

      .stats-grid {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .stats-grid > .stat-card {
        flex: 1 1 calc(33.333% - 14px);
        min-width: 220px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.03);
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        user-select: none;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.5s ease forwards;
      }

      .stat-card:nth-child(1) {
        animation-delay: 0.1s;
      }
      .stat-card:nth-child(2) {
        animation-delay: 0.2s;
      }
      .stat-card:nth-child(3) {
        animation-delay: 0.3s;
      }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stat-card:hover {
        background: rgba(255, 255, 255, 0.06);
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 8px 24px rgba(47, 128, 237, 0.15),
          0 0 40px rgba(47, 128, 237, 0.1);
        border-color: var(--accent-blue);
      }

      .stat-card:active {
        transform: translateY(0);
      }

      .stat-chevron {
        font-size: 0.7rem;
        margin-left: 6px;
        transition: transform 0.3s ease;
        opacity: 0.6;
      }

      .stat-chevron.rotated {
        transform: rotate(180deg);
      }

      .stat-info {
        flex: 1 1 100%;
        width: 100%;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
          opacity 0.3s ease;
        opacity: 0;
      }

      .stat-info.active {
        max-height: 200px;
        opacity: 1;
        margin-top: 15px;
      }

      .stat-info-content {
        background: linear-gradient(
          135deg,
          rgba(47, 128, 237, 0.08) 0%,
          rgba(47, 128, 237, 0.02) 100%
        );
        border: 1px solid rgba(47, 128, 237, 0.3);
        border-radius: 12px;
        padding: 20px;
        animation: slideInFromTop 0.4s ease;
      }

      .stat-info-content h4 {
        color: var(--accent-blue);
        font-size: 0.95rem;
        font-weight: 700;
        margin: 0 0 10px 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .stat-info-content h4 i {
        font-size: 1rem;
      }

      .stat-info-content p {
        color: #b0b8c3;
        font-size: 0.85rem;
        line-height: 1.6;
        margin: 0;
      }

      @keyframes slideInFromTop {
        from {
          transform: translateY(-10px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .stat-card .stat-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--text-muted);
        margin-bottom: 10px;
        font-weight: 600;
      }

      .stat-card .stat-value {
        font-size: 1.6rem;
        font-weight: 800;
        color: var(--accent-green);
        word-break: break-word;
        line-height: 1.2;
      }

      .copy-btn {
        cursor: pointer;
        color: var(--accent-blue);
        margin-left: 10px;
        transition: 0.2s;
        font-size: 0.9rem;
      }

      .copy-btn:hover {
        color: var(--accent-green);
        transform: scale(1.1);
      }

      #copyToast {
        position: fixed;
        top: 20px;
        right: -350px;
        background: linear-gradient(135deg, #27ae60 0%, #02c076 100%);
        color: white;
        padding: 16px 24px;
        border-radius: 10px;
        transition: 0.4s;
        z-index: 9999;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        font-weight: 600;
      }

      #copyToast.show {
        right: 20px;
      }

      .api-status {
        background: rgba(255, 255, 255, 0.02);
        border-radius: 10px;
        padding: 12px 20px;
        font-size: 0.85rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        justify-content: space-between;
        border: 1px solid var(--border-color);
        margin-top: 15px;
      }

      .api-status b {
        color: var(--accent-green);
      }

      #loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: var(--bg-main);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
      }

      .loader-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(47, 128, 237, 0.1);
        border-top: 4px solid var(--accent-blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      .loader-text {
        color: var(--accent-blue);
        font-weight: 700;
        font-size: 1rem;
        letter-spacing: 1.2px;
        text-transform: uppercase;
        animation: pulse 1.5s infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 0.5;
        }
        50% {
          opacity: 1;
        }
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        /* Disable complex animations on mobile for better performance */
        .page-content.active {
          animation: none;
          opacity: 1;
          transform: none;
        }

        .page-header,
        .calc-card,
        .chart-container,
        .data-table-container,
        .stat-card {
          animation: none;
          opacity: 1;
          transform: none;
        }

        .data-table tbody tr {
          animation: none;
          opacity: 1;
        }

        /* Mobile table adjustments */
        .data-table th,
        .data-table td {
          padding: 10px 8px;
          font-size: 0.8rem;
        }

        .data-table th {
          font-size: 0.65rem;
        }

        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .menu-toggle {
          display: block;
        }

        .mobile-overlay {
          display: block;
        }

        .main-content {
          margin-left: 0;
          padding: 80px 20px 40px 20px;
          max-width: 100%;
        }

        .page-header h2 {
          font-size: 1.5rem;
        }

        .calc-card {
          padding: 20px;
        }

        .total-profit-box {
          flex-direction: column;
          gap: 20px;
        }

        .profit-divider {
          width: 100%;
          height: 2px;
        }

        .compound-options {
          flex-direction: column;
          gap: 10px;
        }

        .stats-grid {
          flex-direction: column;
          gap: 12px;
        }

        .stats-grid > .stat-card {
          flex: 1 1 100%;
          min-width: 100%;
        }

        .stat-card {
          padding: 16px;
        }

        .stat-card .stat-value {
          font-size: 1.5rem;
        }

        .stat-card .stat-label {
          font-size: 0.8rem;
        }

        .chart-container {
          height: 280px;
          padding: 15px;
        }

        .data-table th,
        .data-table td {
          padding: 10px 8px;
          font-size: 0.85rem;
        }
      }

      @media (min-width: 769px) and (max-width: 1200px) {
        .main-content {
          padding: 40px 40px;
          max-width: 1200px;
        }
      }

      @media (min-width: 1201px) {
        .main-content {
          padding: 40px 60px;
        }
      }

      /* Page visibility with smooth transitions */
      .page-content {
        display: none;
        opacity: 0;
        transform: translateX(30px);
      }

      .page-content.active {
        display: block;
        animation: slideInPage 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }

      @keyframes slideInPage {
        from {
          opacity: 0;
          transform: translateX(30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .mobile-only {
        display: none;
      }
      .desktop-only {
        display: inline;
      }
      @media (max-width: 600px) {
        .mobile-only {
          display: inline;
        }
        .desktop-only {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div id="loader">
      <div class="loader-spinner"></div>
      <div class="loader-text">Calculating your edge... almost ready</div>
    </div>

    <div id="copyToast"><i class="fas"></i>üöÄ Copied to clipboard!</div>

    <button class="menu-toggle" onclick="toggleSidebar()">
      <i class="fas fa-bars"></i>
    </button>

    <div class="mobile-overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo-container">
          <svg
            class="logo-icon"
            viewBox="0 0 100 100"
            xmlns="http://www.w3.org/2000/svg"
          >
            <defs>
              <linearGradient
                id="logoGradient"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop offset="0%" style="stop-color: #1e90ff" />
                <stop offset="100%" style="stop-color: #00d4ff" />
              </linearGradient>
            </defs>
            <rect width="100" height="100" rx="20" fill="#13161c" />
            <path
              d="M25,70 L35,55 L45,60 L55,40 L65,45 L75,25"
              stroke="url(#logoGradient)"
              stroke-width="6"
              fill="none"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <circle cx="75" cy="25" r="5" fill="#02c076" />
            <path
              d="M70,30 L75,25 L80,30"
              stroke="#02c076"
              stroke-width="3"
              fill="none"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <h1>Trading Suite</h1>
        </div>
        <p>Professional calculator tools.</p>
      </div>
      <nav>
        <ul class="nav-menu">
          <li class="nav-item">
            <a class="nav-link-custom active" onclick="showPage('crypto')">
              <svg
                width="22"
                height="22"
                viewBox="0 0 22 22"
                xmlns="http://www.w3.org/2000/svg"
                style="vertical-align: middle;"
              >
                <defs>
                  <linearGradient
                    id="cryptoGradient"
                    x1="0%"
                    y1="0%"
                    x2="100%"
                    y2="100%"
                  >
                    <stop offset="0%" stop-color="#1e90ff" />
                    <stop offset="100%" stop-color="#00d4ff" />
                  </linearGradient>
                </defs>
                <circle
                  cx="11"
                  cy="11"
                  r="9"
                  fill="#181a20"
                  stroke="url(#cryptoGradient)"
                  stroke-width="2"
                />
                <text
                  x="11"
                  y="15"
                  text-anchor="middle"
                  font-size="10"
                  fill="url(#cryptoGradient)"
                  font-family="Inter, Arial, sans-serif"
                >
                  ‚Çø
                </text>
              </svg>
              <span>Crypto Calculator</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-custom" onclick="showPage('breakout')">
              <img
                src="https://github.com/VetonSyn/Calculator/blob/main/breakpropicon.png?raw=true"
                alt="breakout"
              />
              <span>Breakout Prop</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-custom" onclick="showPage('compound')">
              <svg
                width="22"
                height="22"
                viewBox="0 0 22 22"
                xmlns="http://www.w3.org/2000/svg"
                style="vertical-align: middle;"
              >
                <defs>
                  <linearGradient
                    id="compoundGradient"
                    x1="0%"
                    y1="0%"
                    x2="100%"
                    y2="100%"
                  >
                    <stop offset="0%" stop-color="#1e90ff" />
                    <stop offset="100%" stop-color="#00d4ff" />
                  </linearGradient>
                </defs>
                <rect
                  x="2"
                  y="15"
                  width="4"
                  height="5"
                  rx="1"
                  fill="#181a20"
                  stroke="url(#compoundGradient)"
                  stroke-width="1.5"
                />
                <path
                  d="M6,17 L10,12 L14,14 L18,7"
                  stroke="url(#compoundGradient)"
                  stroke-width="2"
                  fill="none"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle cx="18" cy="7" r="2" fill="#02c076" />
              </svg>
              <span>Account Compounder</span>
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Crypto Calculator Page -->
      <div id="crypto-page" class="page-content active">
        <div class="page-header">
          <h2>Crypto Risk Calculator</h2>
          <p>Calculate position sizing and risk management for crypto trades</p>
        </div>

        <div class="calc-card">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Account Size ($)</label>
              <input
                type="number"
                class="form-control"
                id="acc1"
                oninput="saveNormal();calc1()"
              />
            </div>
            <div class="col-md-4">
              <label class="form-label">Risk %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="risk1"
                  oninput="saveNormal();calc1()"
                />
                <div class="input-group-text">
                  <input
                    type="checkbox"
                    id="lock1"
                    class="form-check-input me-2"
                    onchange="toggleRisk(1)"
                  />
                  3%
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <label class="form-label">Stoploss %</label>
              <input
                type="number"
                class="form-control"
                id="sl1"
                value="0.6"
                step="0.1"
                oninput="calc1()"
              />
            </div>

            <div class="col-md-3">
              <label class="form-label">TP1(R) | %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="tp1_r1"
                  oninput="saveNormal();calc1()"
                />
                <input
                  type="number"
                  class="form-control"
                  id="p1_1"
                  oninput="balance(1,'p1_');saveNormal();calc1()"
                />
              </div>
            </div>
            <div class="col-md-3">
              <label class="form-label">TP2(R) | %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="tp1_r2"
                  oninput="saveNormal();calc1()"
                />
                <input
                  type="number"
                  class="form-control"
                  id="p1_2"
                  oninput="balance(2,'p1_');saveNormal();calc1()"
                />
              </div>
            </div>
            <div class="col-md-3">
              <label class="form-label">TP3(R) | %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="tp1_r3"
                  oninput="saveNormal();calc1()"
                />
                <input
                  type="number"
                  class="form-control"
                  id="p1_3"
                  oninput="balance(3,'p1_');saveNormal();calc1()"
                />
              </div>
            </div>
            <div class="col-md-3">
              <label class="form-label">TP4(R) | %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="tp1_r4"
                  oninput="saveNormal();calc1()"
                />
                <input
                  type="number"
                  class="form-control"
                  id="p1_4"
                  oninput="balance(4,'p1_');saveNormal();calc1()"
                />
              </div>
            </div>

            <div class="col-md-12">
              <label class="form-label">Leverage (x)</label>
              <input
                type="number"
                class="form-control"
                id="lev1"
                oninput="saveNormal();calc1()"
              />
            </div>
          </div>

          <div class="mt-4">
            <div class="res-row risk">
              <span>Risk Amount:</span>
              <b id="riskAmt1">$0.00</b>
            </div>
            <div id="tpContainer1"></div>

            <div class="total-profit-box">
              <div class="profit-item">
                <span class="profit-label">Est. Scaling Profit</span>
                <span id="totalProfitText1" class="profit-value">$0.00</span>
              </div>
              <div class="profit-divider"></div>
              <div class="profit-item">
                <span class="profit-label">Scaled Account Growth</span>
                <span id="accGrow1" class="profit-value">0.00%</span>
              </div>
            </div>

            <div class="res-row pos">
              <span>Position Size:</span>
              <span>
                <b id="pos1">$0.00</b>
                <i class="fas fa-copy copy-btn" onclick="copyVal('pos1')"></i>
              </span>
            </div>
            <div class="res-row pos">
              <span>Margin Required:</span>
              <span>
                <b id="margin1">$0.00</b>
                <i
                  class="fas fa-copy copy-btn"
                  onclick="copyVal('margin1')"
                ></i>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Breakout Prop Calculator Page -->
      <div id="breakout-page" class="page-content">
        <div class="page-header">
          <h2>Breakout Prop Calculator</h2>
          <p>Calculate lot sizes and position metrics for prop trading</p>
        </div>

        <div class="calc-card">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Account Size ($)</label>
              <input
                type="number"
                class="form-control"
                id="acc2"
                oninput="saveAcc(2);calc2()"
              />
            </div>
            <div class="col-md-4">
              <label class="form-label">Risk %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="risk2"
                  value="0.5"
                  oninput="calc2()"
                />
                <div class="input-group-text">
                  <input
                    type="checkbox"
                    id="lock2"
                    class="form-check-input me-2"
                    onchange="toggleRisk(2)"
                  />
                  3%
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <label class="form-label">Stoploss %</label>
              <input
                type="number"
                class="form-control"
                id="sl2"
                value="0.6"
                step="0.1"
                oninput="calc2()"
              />
            </div>

            <div class="col-md-3">
              <label class="form-label">TP1 (R) | %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="tp2_r1"
                  value="1"
                  oninput="calc2()"
                />
                <input
                  type="number"
                  class="form-control"
                  id="p2_1"
                  value="25"
                  oninput="balance(1,'p2_');calc2()"
                />
              </div>
            </div>
            <div class="col-md-3">
              <label class="form-label">TP2 (R) | %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="tp2_r2"
                  value="2"
                  oninput="calc2()"
                />
                <input
                  type="number"
                  class="form-control"
                  id="p2_2"
                  value="25"
                  oninput="balance(2,'p2_');calc2()"
                />
              </div>
            </div>
            <div class="col-md-3">
              <label class="form-label">TP3 (R) | %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="tp2_r3"
                  value="3"
                  oninput="calc2()"
                />
                <input
                  type="number"
                  class="form-control"
                  id="p2_3"
                  value="25"
                  oninput="balance(3,'p2_');calc2()"
                />
              </div>
            </div>
            <div class="col-md-3">
              <label class="form-label">TP4 (R) | %</label>
              <div class="input-group">
                <input
                  type="number"
                  class="form-control"
                  id="tp2_r4"
                  value="4"
                  oninput="calc2()"
                />
                <input
                  type="number"
                  class="form-control"
                  id="p2_4"
                  value="25"
                  oninput="balance(4,'p2_');calc2()"
                />
              </div>
            </div>

            <div class="col-md-12">
              <label class="form-label">Pair</label>
              <select class="form-select" id="pair" onchange="calc2()">
                <option value="BTCUSDT">BTC</option>
                <option value="ETHUSDT">ETH</option>
                <option value="SOLUSDT">SOL</option>
              </select>
            </div>
          </div>

          <div class="mt-4">
            <div class="res-row risk">
              <span>Risk Amount:</span>
              <b id="riskAmt2">$0.00</b>
            </div>
            <div id="tpContainer2"></div>

            <div class="total-profit-box">
              <div class="profit-item">
                <span class="profit-label">Est. Scaling Profit</span>
                <span id="totalProfitText2" class="profit-value">$0.00</span>
              </div>
              <div class="profit-divider"></div>
              <div class="profit-item">
                <span class="profit-label">Scaled Account Growth</span>
                <span id="accGrow2" class="profit-value">0.00%</span>
              </div>
            </div>

            <div class="res-row pos">
              <span>Lot Size:</span>
              <span>
                <b id="lot2">0.0000</b>
                <i class="fas fa-copy copy-btn" onclick="copyVal('lot2')"></i>
              </span>
            </div>
            <div class="res-row pos">
              <span>Margin Required:</span>
              <span>
                <b id="margin2">$0.00</b>
                <i
                  class="fas fa-copy copy-btn"
                  onclick="copyVal('margin2')"
                ></i>
              </span>
            </div>

            <div class="api-status">
              <span
                ><i
                  class="fas fa-circle-check"
                  style="color: var(--accent-green)"
                ></i>
                Bybit API Status: <b>Live</b></span
              >
              <span id="apiTime">--:--:--</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Account compounder Calculator Page -->
      <div id="compound-page" class="page-content">
        <div class="page-header">
          <h2>Account Compounder Calculator</h2>
          <p>
            Visualize your account growth with consistent compounded returns
          </p>
        </div>

        <div class="calc-card">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Starting Capital ($)</label>
              <input
                type="number"
                class="form-control"
                id="startCapital"
                value="1000"
                min="1"
                max="1000000"
                onchange="validateInput(this, 1000000, 'Capital'); debouncedCalc();"
                onblur="if(this.value < 1) this.value = 1;"
              />
              <small
                class="text-danger"
                id="warning-startCapital"
                style="display: none; font-size: 0.7rem"
                >‚ö†Ô∏è Max: $1,000,000</small
              >
            </div>
            <div class="col-md-3">
              <label class="form-label">Total Trades</label>
              <input
                type="number"
                class="form-control"
                id="totalTrades"
                value="100"
                min="1"
                max="5000"
                step="1"
                onchange="validateInput(this, 5000, 'Trades'); debouncedCalc();"
                onblur="if(this.value < 1) this.value = 1;"
              />
              <small
                class="text-danger"
                id="warning-totalTrades"
                style="display: none; font-size: 0.7rem"
                >‚ö†Ô∏è Max: 5,000 trades</small
              >
            </div>
            <div class="col-md-2">
              <label class="form-label">Average Win (%)</label>
              <input
                type="number"
                class="form-control"
                id="avgWin"
                value="2"
                step="0.1"
                min="0.1"
                max="10"
                onchange="validateInput(this, 10, 'Win %'); debouncedCalc();"
                onblur="if(this.value < 0.1) this.value = 0.1;"
              />
              <small
                class="text-danger"
                id="warning-avgWin"
                style="display: none; font-size: 0.7rem"
                >‚ö†Ô∏è Max: 10%</small
              >
            </div>
            <div class="col-md-2">
              <label class="form-label">Average Loss (%)</label>
              <input
                type="number"
                class="form-control"
                id="avgLoss"
                value="1"
                step="0.1"
                min="0.1"
                max="10"
                onchange="validateInput(this, 10, 'Loss %'); debouncedCalc();"
                onblur="if(this.value < 0.1) this.value = 0.1;"
              />
              <small
                class="text-danger"
                id="warning-avgLoss"
                style="display: none; font-size: 0.7rem"
                >‚ö†Ô∏è Max: 10%</small
              >
            </div>
            <div class="col-md-2">
              <label class="form-label">Winrate (%)</label>
              <input
                type="number"
                class="form-control"
                id="winRatePct"
                value="45"
                step="1"
                min="0"
                max="100"
                onchange="validateInput(this, 100, 'Winrate'); debouncedCalc();"
                onblur="if(this.value < 0) this.value = 0; if(this.value > 100) this.value = 100;"
              />
              <small
                class="text-danger"
                id="warning-winRatePct"
                style="display: none; font-size: 0.7rem"
                >‚ö†Ô∏è Max: 100%</small
              >
            </div>
          </div>

          <!-- Frequency selection removed; x-axis now represents trades -->

          <div class="chart-container">
            <div class="chart-loading" id="chartLoading" style="display: none">
              <div class="spinner-wrapper">
                <div class="loader-spinner"></div>
                <div class="spinner-glow"></div>
              </div>
              <div class="loader-text">Calculating...</div>
            </div>
            <canvas id="compoundChart"></canvas>
          </div>

          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>
                    <span class="th-trade-label desktop-only">Trade #</span
                    ><span class="th-trade-label mobile-only">#</span>
                  </th>
                            <th><span class="desktop-only">Balance</span><span class="mobile-only">Bal.</span></th>
                            <th><span class="desktop-only">Profit</span><span class="mobile-only">Prof.</span></th>
                            <th><span class="desktop-only">Growth %</span><span class="mobile-only">Gr. %</span></th>
                </tr>
              </thead>
              <tbody id="dataTableBody"></tbody>
            </table>
          </div>

          <div id="statsContainer" class="stats-grid"></div>
        </div>
      </div>
      <!-- Flagcounter -->
      <div class="d-flex justify-content-center mt-5">
        <a href="https://www.flagcounter.me/details/gub">
          <img
            src="https://www.flagcounter.me/gub/"
            alt="Flag Counter"
            style="max-width: 100%; height: auto"
          />
        </a>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let savedRisk = { 1: 1, 2: 0.5 };
      let compoundChart = null;
      let monteBalances = null;

      // Page Navigation
      function showPage(page) {
        // Hide all pages
        document
          .querySelectorAll(".page-content")
          .forEach((p) => p.classList.remove("active"));
        // Remove active from all nav links
        document
          .querySelectorAll(".nav-link-custom")
          .forEach((l) => l.classList.remove("active"));

        // Show selected page
        if (page === "crypto") {
          document.getElementById("crypto-page").classList.add("active");
          document
            .querySelector('.nav-link-custom[onclick*="crypto"]')
            .classList.add("active");
        } else if (page === "breakout") {
          document.getElementById("breakout-page").classList.add("active");
          document
            .querySelector('.nav-link-custom[onclick*="breakout"]')
            .classList.add("active");
        } else if (page === "compound") {
          document.getElementById("compound-page").classList.add("active");
          document
            .querySelector('.nav-link-custom[onclick*="compound"]')
            .classList.add("active");
          calcCompound(); // Initialize chart
        }

        // Close sidebar and overlay on mobile
        if (window.innerWidth <= 768) {
          const sidebar = document.getElementById("sidebar");
          const overlay = document.querySelector(".mobile-overlay");
          if (sidebar) sidebar.classList.remove("active");
          if (overlay) overlay.classList.remove("active");
        }
      }

      let lastScrollTop = 0;
      let ticking = false;

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.querySelector(".mobile-overlay");
        sidebar.classList.toggle("active");
        overlay.classList.toggle("active");
      }

      function closeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.querySelector(".mobile-overlay");
        sidebar.classList.remove("active");
        overlay.classList.remove("active");
      }

      // Mobile menu scroll behavior
      if (window.innerWidth <= 768) {
        window.addEventListener("scroll", function () {
          if (!ticking) {
            window.requestAnimationFrame(function () {
              handleMenuScroll();
              ticking = false;
            });
            ticking = true;
          }
        });
      }

      function handleMenuScroll() {
        const menuToggle = document.querySelector(".menu-toggle");
        const scrollTop =
          window.pageYOffset || document.documentElement.scrollTop;
        const documentHeight = document.documentElement.scrollHeight;
        const windowHeight = window.innerHeight;

        // Only apply scroll behavior if content is taller than viewport
        if (documentHeight > windowHeight * 1.2 && menuToggle) {
          if (scrollTop > lastScrollTop && scrollTop > 100) {
            // Scrolling down & past 100px
            menuToggle.classList.add("hide");
          } else if (scrollTop < lastScrollTop || scrollTop < 50) {
            // Scrolling up or near top
            menuToggle.classList.remove("hide");
          }
        }

        lastScrollTop = scrollTop;
      }

      // Save/Load Functions
      function saveNormal() {
        const get = (id) => document.getElementById(id);
        const data = {
          acc: get("acc1") ? get("acc1").value : "",
          risk: get("risk1") ? get("risk1").value : "",
          lev: get("lev1") ? get("lev1").value : "",
          tps: [
            get("tp1_r1") ? get("tp1_r1").value : "",
            get("tp1_r2") ? get("tp1_r2").value : "",
            get("tp1_r3") ? get("tp1_r3").value : "",
            get("tp1_r4") ? get("tp1_r4").value : "",
          ],
          partials: [
            get("p1_1") ? get("p1_1").value : "",
            get("p1_2") ? get("p1_2").value : "",
            get("p1_3") ? get("p1_3").value : "",
            get("p1_4") ? get("p1_4").value : "",
          ],
        };
        try {
          localStorage.setItem("normal_calc_state", JSON.stringify(data));
        } catch (e) {
          /* ignore storage errors */
        }
      }

      function saveAcc(num) {
        const el = document.getElementById("acc" + num);
        if (el) {
          try {
            localStorage.setItem("savedAccSize" + num, el.value);
          } catch (e) {}
        }
      }

      async function initializeApp() {
        await new Promise((resolve) => setTimeout(resolve, 1200));

        const normalData = JSON.parse(
          localStorage.getItem("normal_calc_state")
        );
        if (normalData) {
          const setIf = (id, v) => {
            const el = document.getElementById(id);
            if (el) el.value = v;
          };
          setIf("acc1", normalData.acc);
          setIf("risk1", normalData.risk);
          setIf("lev1", normalData.lev);
          (normalData.tps || []).forEach((val, i) =>
            setIf(`tp1_r${i + 1}`, val)
          );
          (normalData.partials || []).forEach((val, i) =>
            setIf(`p1_${i + 1}`, val)
          );
        } else {
          const setIf = (id, v) => {
            const el = document.getElementById(id);
            if (el) el.value = v;
          };
          setIf("acc1", 1000);
          setIf("risk1", 1);
          setIf("lev1", 10);
          [2, 3, 4, 5].forEach((val, i) => setIf(`tp1_r${i + 1}`, val));
          [25, 25, 25, 25].forEach((val, i) => setIf(`p1_${i + 1}`, val));
        }
        const acc2El = document.getElementById("acc2");
        if (acc2El)
          acc2El.value = localStorage.getItem("savedAccSize2") || 5000;

        const loaderEl = document.getElementById("loader");
        if (loaderEl) {
          loaderEl.style.opacity = "0";
          setTimeout(() => {
            if (loaderEl) loaderEl.style.display = "none";
          }, 500);
        }

        calc1();
        calc2();
      }

      function toggleRisk(num) {
        const cb = document.getElementById("lock" + num);
        const input = document.getElementById("risk" + num);
        if (cb.checked) {
          savedRisk[num] = input.value;
          input.value = 3;
        } else {
          input.value = savedRisk[num];
        }
        num === 1 ? calc1() : calc2();
      }

      function balance(idx, pre) {
        let inputs = [1, 2, 3, 4].map((i) => document.getElementById(pre + i));
        let total = 0;
        for (let i = 0; i < idx; i++) total += parseFloat(inputs[i].value) || 0;
        if (total > 100) {
          inputs[idx - 1].value = (
            100 -
            (total - parseFloat(inputs[idx - 1].value))
          ).toFixed(1);
          total = 100;
        }
        let remaining = 100 - total;
        let countLeft = 4 - idx;
        if (countLeft > 0) {
          let share = (remaining / countLeft).toFixed(1);
          for (let i = idx; i < 4; i++) inputs[i].value = share;
        }
      }

      // Crypto Calculator
      function calc1() {
        const accEl = document.getElementById("acc1");
        const riskEl = document.getElementById("risk1");
        const slEl = document.getElementById("sl1");
        const levEl = document.getElementById("lev1");

        const acc = accEl ? parseFloat(accEl.value) || 0 : 0;
        const riskVal = riskEl ? parseFloat(riskEl.value) || 0 : 0;
        const sl = slEl ? parseFloat(slEl.value) || 0 : 0;
        const lev = levEl ? parseFloat(levEl.value) || 1 : 1;

        const riskAmt = (acc * riskVal) / 100;
        const posSize = sl > 0 ? (riskAmt * 100) / sl : 0;

        const riskAmtEl = document.getElementById("riskAmt1");
        const posEl = document.getElementById("pos1");
        const marginEl = document.getElementById("margin1");
        if (riskAmtEl) riskAmtEl.innerText = "$" + riskAmt.toFixed(2);
        if (posEl) posEl.innerText = "$" + posSize.toFixed(2);
        if (marginEl) marginEl.innerText = "$" + (posSize / lev).toFixed(2);

        let tpHTML = "",
          totalScaling = 0;
        for (let i = 1; i <= 4; i++) {
          const tpR = document.getElementById(`tp1_r${i}`);
          const pPctEl = document.getElementById(`p1_${i}`);
          const rMult = tpR ? parseFloat(tpR.value) || 0 : 0;
          const pPct = pPctEl ? parseFloat(pPctEl.value) || 0 : 0;
          const full = riskAmt * rMult;
          const scaled = full * (pPct / 100);
          totalScaling += scaled;
          tpHTML += `
                <div class="res-row tp">
                    <div>TP${i} 100% (<span class="highlight-r">${rMult}R</span>) | <b>$${full.toFixed(
            2
          )}</b></div>
                    <div class="scaling-box"><b>$${scaled.toFixed(
                      2
                    )}</b> | <span class="highlight-pct">${pPct}%</span></div>
                </div>`;
        }

        const tpContainer1 = document.getElementById("tpContainer1");
        if (tpContainer1) tpContainer1.innerHTML = tpHTML;
        const totalProfitText1 = document.getElementById("totalProfitText1");
        if (totalProfitText1)
          totalProfitText1.innerText = `$${totalScaling.toFixed(2)}`;
        const accGrow1 = document.getElementById("accGrow1");
        if (accGrow1)
          accGrow1.innerText = `${
            acc > 0 ? ((totalScaling / acc) * 100).toFixed(2) : 0
          }%`;
      }

      // Breakout Prop Calculator
      async function calc2() {
        const accEl = document.getElementById("acc2");
        const riskEl = document.getElementById("risk2");
        const slEl = document.getElementById("sl2");
        const pairEl = document.getElementById("pair");

        const acc = accEl ? parseFloat(accEl.value) || 0 : 0;
        const riskVal = riskEl ? parseFloat(riskEl.value) || 0 : 0;
        const slP = slEl ? parseFloat(slEl.value) || 0 : 0;
        const pair = pairEl ? pairEl.value : "BTCUSDT";

        try {
          const res = await fetch(
            `https://api.bybit.com/v5/market/tickers?category=linear&symbol=${pair}`
          );
          const data = await res.json();
          const price = parseFloat(data.result.list[0].lastPrice);
          const riskAmt = (acc * riskVal) / 100;
          const slDist = price * (slP / 100);
          const lot = slDist > 0 ? riskAmt / slDist : 0;

          const riskAmt2El = document.getElementById("riskAmt2");
          const lot2El = document.getElementById("lot2");
          const margin2El = document.getElementById("margin2");
          const apiTimeEl = document.getElementById("apiTime");
          if (riskAmt2El) riskAmt2El.innerText = "$" + riskAmt.toFixed(2);
          if (lot2El) lot2El.innerText = lot.toFixed(5);
          if (margin2El)
            margin2El.innerText = "$" + ((lot * price) / 5).toFixed(2);
          if (apiTimeEl)
            apiTimeEl.innerText = new Date().toLocaleTimeString("nl-NL");

          let tpHTML = "",
            totalScaling = 0;
          for (let i = 1; i <= 4; i++) {
            const tpR = document.getElementById(`tp2_r${i}`);
            const pPctEl = document.getElementById(`p2_${i}`);
            const rMult = tpR ? parseFloat(tpR.value) || 0 : 0;
            const pPct = pPctEl ? parseFloat(pPctEl.value) || 0 : 0;
            const full = slDist * rMult * lot;
            const scaled = full * (pPct / 100);
            totalScaling += scaled;
            tpHTML += `
                    <div class="res-row tp">
                        <div>TP${i} 100% (<span class="highlight-r">${rMult}R</span>) | <b>$${full.toFixed(
              2
            )}</b></div>
                        <div class="scaling-box"><b>$${scaled.toFixed(
                          2
                        )}</b> | <span class="highlight-pct">${pPct}%</span></div>
                    </div>`;
          }

          const tpContainer2 = document.getElementById("tpContainer2");
          if (tpContainer2) tpContainer2.innerHTML = tpHTML;
          const totalProfitText2 = document.getElementById("totalProfitText2");
          if (totalProfitText2)
            totalProfitText2.innerText = `$${totalScaling.toFixed(2)}`;
          const accGrow2 = document.getElementById("accGrow2");
          if (accGrow2)
            accGrow2.innerText = `${
              acc > 0 ? ((totalScaling / acc) * 100).toFixed(2) : 0
            }%`;
        } catch (e) {
          console.error("Bybit API Error", e);
        }
      }

      let calcTimeout = null;

      function validateInput(input, maxValue, label) {
        const warningEl = document.getElementById("warning-" + input.id);
        const value = parseFloat(input.value);
        const minValue = parseFloat(input.min) || 0;

        // Check for invalid values
        if (isNaN(value) || !isFinite(value)) {
          input.value = input.defaultValue || minValue;
          return;
        }

        // Check maximum
        if (value > maxValue) {
          input.value = maxValue;
          if (warningEl) {
            warningEl.style.display = "block";
            setTimeout(() => {
              warningEl.style.display = "none";
            }, 3000);
          }
        }

        // Check minimum
        if (value < minValue) {
          input.value = minValue;
        }
      }

      function toggleStatInfo(id) {
        const infoEl = document.getElementById("info-" + id);
        const chevronEl = document.getElementById("chevron-" + id);

        // Close all other info panels
        document.querySelectorAll(".stat-info").forEach((el) => {
          if (el.id !== "info-" + id) {
            el.classList.remove("active");
          }
        });
        document.querySelectorAll(".stat-chevron").forEach((el) => {
          if (el.id !== "chevron-" + id) {
            el.classList.remove("rotated");
          }
        });

        // Toggle current panel
        if (infoEl) infoEl.classList.toggle("active");
        if (chevronEl) chevronEl.classList.toggle("rotated");
      }

      function debouncedCalc() {
        clearTimeout(calcTimeout);
        calcTimeout = setTimeout(calcCompound, 300);
      }

      // Simplified Monte Carlo simulation with fixed win/loss percentages
      function calcCompound() {
        const startCapEl = document.getElementById("startCapital");
        const startCap = startCapEl
          ? parseFloat(startCapEl.value) || 1000
          : 1000;

        // Get input values
        const totalTradesEl = document.getElementById("totalTrades");
        const avgWinEl = document.getElementById("avgWin");
        const avgLossEl = document.getElementById("avgLoss");
        const winRateEl = document.getElementById("winRatePct");

        const totalTrades = totalTradesEl
          ? parseInt(totalTradesEl.value) || 100
          : 100;
        const avgWinPct = avgWinEl ? parseFloat(avgWinEl.value) || 2 : 2;
        const avgLossPct = avgLossEl ? parseFloat(avgLossEl.value) || 1 : 1;
        const winRatePct = winRateEl ? parseFloat(winRateEl.value) || 50 : 50;

        // Show loading overlay
        const loadingEl = document.getElementById("chartLoading");
        if (loadingEl) loadingEl.style.display = "flex";

        // Run simulation asynchronously
        setTimeout(() => {
          const labels = [];
          const balances = [startCap];
          const drawdowns = [0];
          let bal = startCap;
          let peak = bal;
          let maxDD = 0;

          // Deterministic pseudo-random for realistic win/loss streaks
          // Seed based ONLY on capital - NOT trades, winrate or win/loss %
          // This ensures: same capital = same sequence, changing trades just extends/shortens
          const seed = Math.floor(startCap * 1000) % 999983;
          let rng = seed || 1; // Ensure non-zero seed

          // Simple deterministic pseudo-random generator
          const pseudoRandom = () => {
            rng = (rng * 48271) % 2147483647;
            return rng / 2147483647;
          };

          for (let t = 1; t <= totalTrades; t++) {
            labels.push(t.toString());

            // Use pseudo-random with winrate threshold for realistic streaks
            const rand = pseudoRandom();
            const isWin = rand < winRatePct / 100;

            if (isWin) {
              // Win: compound effect - multiply by (1 + win%)
              bal = bal * (1 + avgWinPct / 100);
            } else {
              // Loss: compound effect - multiply by (1 - loss%)
              // Cap loss at 99% to prevent balance from going negative/zero
              const safeLoss = Math.min(avgLossPct, 99);
              bal = bal * (1 - safeLoss / 100);
            }

            // Safety check: ensure balance stays positive and finite
            if (!isFinite(bal) || bal <= 0) {
              bal = 0.01; // Set to 1 cent minimum
            }

            balances.push(bal);

            // Calculate drawdown from peak
            if (bal > peak) {
              peak = bal;
            }
            const dd = peak > 0 ? ((peak - bal) / peak) * 100 : 0;
            drawdowns.push(dd);
            if (dd > maxDD) {
              maxDD = dd;
            }
          }

          const finalBal = balances[balances.length - 1];
          const profit = finalBal - startCap;
          const roi = (profit / startCap) * 100;

          // Format ROI percentage with safety checks
          const formatROI = (value) => {
            if (!isFinite(value) || isNaN(value)) return "0.00";
            if (Math.abs(value) >= 1000000)
              return value > 0 ? "+999,999" : "-999,999";
            if (Math.abs(value) >= 10000) return value.toFixed(0);
            return value.toFixed(2);
          };

          // Format large numbers
          const formatMoney = (val) => {
            // Handle extreme/invalid values
            if (!isFinite(val) || isNaN(val)) return "$0.00";

            const isNegative = val < 0;
            const absVal = Math.abs(val);
            const sign = isNegative ? "-" : "";

            // Cap display at quadrillions to prevent overflow
            if (absVal >= 1000000000000000) return sign + "$999.9T+";
            if (absVal >= 1000000000000)
              return sign + "$" + (absVal / 1000000000000).toFixed(1) + "T";
            if (absVal >= 1000000000)
              return sign + "$" + (absVal / 1000000000).toFixed(1) + "B";
            if (absVal >= 1000000)
              return sign + "$" + (absVal / 1000000).toFixed(1) + "M";
            if (absVal >= 1000)
              return sign + "$" + (absVal / 1000).toFixed(1) + "K";
            return sign + "$" + absVal.toFixed(2);
          };

          // Create single dataset
          const datasets = [
            {
              label: "Equity Curve",
              data: balances,
              borderColor: "#02c076",
              backgroundColor: "rgba(2, 192, 118, 0.1)",
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 7,
              pointHoverBackgroundColor: "#02c076",
              pointHoverBorderColor: "#fff",
              pointHoverBorderWidth: 2,
              drawdowns: drawdowns,
            },
          ];

          // Create stats HTML with clickable cards
          const statsHTML = `
                <div class="stat-card" onclick="toggleStatInfo('final-balance')">
                    <div class="stat-label">Final Balance <i class="fas fa-chevron-down stat-chevron" id="chevron-final-balance"></i></div>
                    <div class="stat-value" style="color: #02c076">${formatMoney(
                      finalBal
                    )}</div>
                    <small style="color: var(--text-muted); font-size: 0.75rem;">Starting: ${formatMoney(
                      startCap
                    )}</small>
                </div>
                <div class="stat-card" onclick="toggleStatInfo('total-profit')">
                    <div class="stat-label">Total Profit <i class="fas fa-chevron-down stat-chevron" id="chevron-total-profit"></i></div>
                    <div class="stat-value" style="color: ${
                      profit >= 0 ? "#02c076" : "#f84960"
                    }">${formatMoney(profit)}</div>
                    <small style="color: var(--text-muted); font-size: 0.75rem;">ROI: ${formatROI(
                      roi
                    )}%</small>
                </div>
                <div class="stat-card" onclick="toggleStatInfo('max-drawdown')">
                    <div class="stat-label">Max Drawdown <i class="fas fa-chevron-down stat-chevron" id="chevron-max-drawdown"></i></div>
                    <div class="stat-value" style="color: #f84960">${
                      isFinite(maxDD) ? maxDD.toFixed(2) : "0.00"
                    }%</div>
                    <small style="color: var(--text-muted); font-size: 0.75rem;">Largest drop from peak</small>
                </div>
            `;

          const infoHTML = `
                <div class="stat-info" id="info-final-balance">
                    <div class="stat-info-content">
                        <h4><i class="fas fa-wallet"></i> Final Balance</h4>
                        <p>This is your total account value after completing all ${totalTrades} trades. It shows how your starting capital of ${formatMoney(
            startCap
          )} grew (or declined) based on your trading parameters with full compound effect.</p>
                    </div>
                </div>
                <div class="stat-info" id="info-total-profit">
                    <div class="stat-info-content">
                        <h4><i class="fas fa-chart-line"></i> Total Profit & ROI</h4>
                            <p>This shows your total profit or loss in dollars, and your Return on Investment (ROI) as a percentage. ROI tells you how much your starting money grew or shrank. For example, a 44.51% ROI means if you began with $1, you‚Äôd end up with $1.44. Each win adds to your balance and builds on the last.</p>
                    </div>
                </div>
                <div class="stat-info" id="info-max-drawdown">
                    <div class="stat-info-content">
                        <h4><i class="fas fa-arrow-trend-down"></i> Maximum Drawdown</h4>
                            <p>The biggest drop from your highest account value to a low point during the simulation. For example, a ${maxDD.toFixed(
                              2
                            )}% drawdown means your account fell ${maxDD.toFixed(
            2
          )}% from its peak before recovering.</p>
                    </div>
                </div>
            `;

          // Store balances for reference
          monteBalances = balances;
          if (loadingEl) loadingEl.style.display = "none";

          const statsEl = document.getElementById("statsContainer");
          if (statsEl) statsEl.innerHTML = statsHTML + infoHTML;

          // Generate data table (show first 30 and last 10 trades for performance)
          let tableHTML = "";
          const showFirst = Math.min(30, totalTrades);
          const showLast = Math.min(10, totalTrades);

          for (let i = 1; i <= showFirst; i++) {
            const bal = balances[i];
            const profit = bal - startCap;
            const growth = (bal / startCap - 1) * 100;

            // Per-trade growth for coloring (compared to previous trade)
            const prevBal = balances[i - 1];
            const tradeChange = ((bal - prevBal) / prevBal) * 100;
            const growthColor =
              tradeChange >= 0 ? "var(--accent-green)" : "var(--accent-red)";

            // Format growth percentage safely
            const growthDisplay = isFinite(growth) ? growth.toFixed(2) : "0.00";

            tableHTML += `
                    <tr>
                        <td class="period-col">Trade ${i}</td>
                        <td class="balance-col">${formatMoney(bal)}</td>
                        <td class="profit-col">${formatMoney(profit)}</td>
                        <td style="color: ${growthColor}">${growthDisplay}%</td>
                    </tr>
                `;
          }

          if (totalTrades > showFirst + showLast) {
            tableHTML += `<tr><td colspan="4" style="text-align:center; color: var(--text-muted); font-style: italic;">... ${
              totalTrades - showFirst - showLast
            } trades omitted ...</td></tr>`;

            for (let i = totalTrades - showLast + 1; i <= totalTrades; i++) {
              const bal = balances[i];
              const profit = bal - startCap;
              const growth = (bal / startCap - 1) * 100;

              // Per-trade growth for coloring
              const prevBal = balances[i - 1];
              const tradeChange = ((bal - prevBal) / prevBal) * 100;
              const growthColor =
                tradeChange >= 0 ? "var(--accent-green)" : "var(--accent-red)";

              // Format growth percentage safely
              const growthDisplay = isFinite(growth)
                ? growth.toFixed(2)
                : "0.00";

              tableHTML += `
                        <tr>
                            <td class="period-col">Trade ${i}</td>
                            <td class="balance-col">${formatMoney(bal)}</td>
                            <td class="profit-col">${formatMoney(profit)}</td>
                            <td style="color: ${growthColor}">${growthDisplay}%</td>
                        </tr>
                    `;
            }
          }

          const tableEl = document.getElementById("dataTableBody");
          if (tableEl) tableEl.innerHTML = tableHTML;

          // Update Chart
          const canvasEl = document.getElementById("compoundChart");
          if (!canvasEl) return; // if canvas not present (page not visible), exit safely
          const ctx = canvasEl.getContext("2d");

          if (compoundChart) {
            compoundChart.destroy();
          }

          let frequencyLabel = "Trades";

          compoundChart = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: datasets,
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: {
                mode: "index",
                intersect: false,
              },
              plugins: {
                legend: {
                  display: true,
                  position: "top",
                  labels: {
                    color: "#848e9c",
                    font: { size: 12, weight: "600" },
                    padding: 15,
                    usePointStyle: true,
                  },
                },
                tooltip: {
                  backgroundColor: "#181a20",
                  titleColor: "#fff",
                  bodyColor: "#02c076",
                  borderColor: "#2b2f36",
                  borderWidth: 1,
                  padding: 12,
                  displayColors: true,
                  callbacks: {
                    title: function (context) {
                      const idx =
                        context && context[0] ? context[0].dataIndex : 0;
                      return "Trade #" + idx;
                    },
                    label: function (context) {
                      return "Balance: $" + context.parsed.y.toFixed(2);
                    },
                    afterLabel: function (context) {
                      const ds = context.dataset || {};
                      const idx = context.dataIndex || 0;
                      const dd =
                        ds.drawdowns && ds.drawdowns[idx]
                          ? ds.drawdowns[idx].toFixed(2)
                          : "0.00";
                      return "Drawdown: " + dd + "%";
                    },
                  },
                },
              },
              scales: {
                x: {
                  grid: {
                    color: "rgba(43, 47, 54, 0.3)",
                    drawBorder: false,
                  },
                  ticks: {
                    color: "#848e9c",
                    font: { size: 10 },
                    maxTicksLimit: 15,
                  },
                  title: {
                    display: true,
                    text: frequencyLabel,
                    color: "#848e9c",
                    font: { size: 12, weight: "600" },
                  },
                },
                y: {
                  type: "logarithmic",
                  grid: {
                    color: "rgba(43, 47, 54, 0.3)",
                    drawBorder: false,
                  },
                  ticks: {
                    color: "#848e9c",
                    font: { size: 10 },
                    callback: function (value) {
                      if (value >= 1000000)
                        return "$" + (value / 1000000).toFixed(1) + "M";
                      if (value >= 1000)
                        return "$" + (value / 1000).toFixed(0) + "K";
                      return "$" + value.toFixed(0);
                    },
                  },
                  title: {
                    display: true,
                    text: "Balance ($) - Log Scale",
                    color: "#848e9c",
                    font: { size: 12, weight: "600" },
                  },
                },
              },
            },
          });
        }, 10); // end of setTimeout
      }

      function copyVal(id) {
        const el = document.getElementById(id);
        const t = document.getElementById("copyToast");
        if (!el) return;
        const text = (el.innerText || "").replace("$", "").replace(",", "");
        try {
          navigator.clipboard.writeText(text);
        } catch (e) {}
        if (t) {
          t.classList.add("show");
          setTimeout(() => {
            if (t) t.classList.remove("show");
          }, 2000);
        }
      }

      window.onload = initializeApp;
    </script>
  </body>
</html>
