<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Risk Calculator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext y='52' font-size='52'%3E%F0%9F%9A%80%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Ctext y='140' font-size='140'%3E%F0%9F%9A%80%3C/text%3E%3C/svg%3E">
    <meta name="theme-color" content="#0b0e11">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-main: #0b0e11;
            --bg-card: #181a20;
            --accent-blue: #2f80ed;
            --accent-red: #f84960;
            --accent-green: #02c076;
            --accent-orange: #f39c12;
            --border-color: #2b2f36;
            --text-muted: #848e9c;
            --input-bg: #1e222a;
        }

        body { background-color: var(--bg-main); color: #eaecef; font-family: 'Inter', sans-serif; padding-bottom: 3rem; overflow-x: hidden; }
        .container { max-width: 950px; margin-top: 2rem; }

        #loader {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--bg-main); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .loader-spinner {
            width: 50px; height: 50px; border: 3px solid rgba(47, 128, 237, 0.1);
            border-top: 3px solid var(--accent-blue); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        .loader-text { color: var(--accent-blue); font-weight: 600; font-size: 0.9rem; letter-spacing: 1px; text-transform: uppercase; animation: pulse 1.5s infinite; }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        .calc-card { background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; margin-top: 20px; }
        .nav-tabs { border-bottom: 1px solid var(--border-color) !important; }
        .nav-link { color: var(--text-muted) !important; border: none !important; font-weight: 600; padding: 10px 20px; cursor: pointer; }
        .nav-link.active { background: none !important; color: var(--accent-blue) !important; border-bottom: 3px solid var(--accent-blue) !important; }

        .form-control, .form-select { background-color: var(--input-bg); border: 1px solid var(--border-color); color: #fff; border-radius: 8px; }
        .form-control:focus { background-color: var(--input-bg); border-color: var(--accent-blue); box-shadow: none; color: #fff; }
        
        .input-group-text { background-color: var(--input-bg); border: 1px solid var(--border-color); color: #fff; }
        .form-check-input { background-color: var(--bg-main); border: 1px solid var(--border-color); cursor: pointer; }

        .res-row { background: rgba(255,255,255,0.03); border-radius: 8px; padding: 12px 20px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid transparent; }
        .res-row.tp { border-left-color: var(--accent-green); }
        .res-row.pos { border-left-color: var(--accent-blue); }
        
        /* Highlight styles */
        .highlight-r { color: var(--accent-orange); font-weight: 700; }
        .highlight-pct { color: var(--accent-orange); font-weight: 600; }
        .scaling-box { text-align: right; }

        /* Modernized Profit Box */
        .total-profit-box {
            background: linear-gradient(135deg, #02a163 0%, #02c076 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 4px 15px rgba(2, 192, 118, 0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .profit-item { text-align: center; }
        .profit-label { 
            display: block; 
            font-size: 0.7rem; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            color: rgba(255,255,255,0.8) !important;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .profit-value { 
            display: block; 
            font-size: 1.4rem; 
            font-weight: 800; 
            color: #ffffff !important;
        }
        .profit-divider { width: 1px; height: 40px; background: rgba(255,255,255,0.2); }

        .api-status { background: rgba(255,255,255,0.02); border-radius: 8px; padding: 8px 15px; font-size: 0.75rem; color: var(--text-muted); display: flex; align-items: center; justify-content: space-between; border: 1px solid var(--border-color); }
        .api-status b { color: var(--accent-green); }

        .copy-btn { cursor: pointer; color: var(--accent-blue); margin-left: 10px; transition: 0.2s; }
        #copyToast { position: fixed; top: 20px; right: -350px; background: #27ae60; color: white; padding: 15px; border-radius: 8px; transition: 0.5s; z-index: 9999; }
        #copyToast.show { right: 20px; }
    </style>
</head>
<body>

<div id="loader">
    <div class="loader-spinner"></div>
    <div class="loader-text">Calculating your edge... almost ready</div>
</div>

<div id="copyToast">ðŸš€ Copied to clipboard!</div>

<div class="container">
    <ul class="nav nav-tabs" id="calcTabs" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#normal" type="button">Crypto Calculator</button></li>
        <li class="nav-item">
            <button class="nav-link d-flex align-items-center" data-bs-toggle="tab" data-bs-target="#breakout" type="button" style="gap:8px;">
                <img src="https://github.com/VetonSyn/Calculator/blob/main/breakpropicon.png?raw=true" alt="breakout icon" style="width:20px; height:20px; object-fit:contain; display:block;">
                Breakout Prop
            </button>
        </li>
    </ul>

    <div class="tab-content pt-3">
        <div class="tab-pane fade show active" id="normal" role="tabpanel">
            <div class="calc-card">
                <div class="row g-3">
                    <div class="col-md-4"><label class="form-label">Account Size ($)</label><input type="number" class="form-control" id="acc1" oninput="saveNormal();calc1()"></div>
                    <div class="col-md-4">
                        <label class="form-label">Risk %</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="risk1" oninput="saveNormal();calc1()">
                            <div class="input-group-text"><input type="checkbox" id="lock1" class="form-check-input me-2" onchange="toggleRisk(1)"> 3%</div>
                        </div>
                    </div>
                    <div class="col-md-4"><label class="form-label">Stoploss %</label><input type="number" class="form-control" id="sl1" value="0.6" step="0.1" oninput="calc1()"></div>
                    
                    <div class="col-md-3"><label class="form-label">TP1(R) | %</label><div class="input-group"><input type="number" class="form-control" id="tp1_r1" oninput="saveNormal();calc1()"><input type="number" class="form-control" id="p1_1" oninput="balance(1,'p1_');saveNormal();calc1()"></div></div>
                    <div class="col-md-3"><label class="form-label">TP2(R) | %</label><div class="input-group"><input type="number" class="form-control" id="tp1_r2" oninput="saveNormal();calc1()"><input type="number" class="form-control" id="p1_2" oninput="balance(2,'p1_');saveNormal();calc1()"></div></div>
                    <div class="col-md-3"><label class="form-label">TP3(R) | %</label><div class="input-group"><input type="number" class="form-control" id="tp1_r3" oninput="saveNormal();calc1()"><input type="number" class="form-control" id="p1_3" oninput="balance(3,'p1_');saveNormal();calc1()"></div></div>
                    <div class="col-md-3"><label class="form-label">TP4(R) | %</label><div class="input-group"><input type="number" class="form-control" id="tp1_r4" oninput="saveNormal();calc1()"><input type="number" class="form-control" id="p1_4" oninput="balance(4,'p1_');saveNormal();calc1()"></div></div>

                    <div class="col-md-12"><label class="form-label">Leverage (x)</label><input type="number" class="form-control" id="lev1" oninput="saveNormal();calc1()"></div>
                </div>

                <div class="mt-4">
                    <div class="res-row" style="border-left-color: var(--accent-red);"><span>Risk Amount:</span><b id="riskAmt1">$0.00</b></div>
                    <div id="tpContainer1"></div>
                    
                    <div class="total-profit-box">
                        <div class="profit-item">
                            <span class="profit-label">Est. Scaling Profit</span>
                            <span id="totalProfitText1" class="profit-value">$0.00</span>
                        </div>
                        <div class="profit-divider"></div>
                        <div class="profit-item">
                            <span class="profit-label">Scaled Acccount Growth</span>
                            <span id="accGrow1" class="profit-value">0.00%</span>
                        </div>
                    </div>

                    <div class="res-row pos"><span>Position Size:</span><span><b id="pos1">$0.00</b><i class="fas fa-copy copy-btn" onclick="copyVal('pos1')"></i></span></div>
                    <div class="res-row pos"><span>Margin Required:</span><span><b id="margin1">$0.00</b><i class="fas fa-copy copy-btn" onclick="copyVal('margin1')"></i></span></div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="breakout" role="tabpanel">
            <div class="calc-card">
                <div class="row g-3">
                    <div class="col-md-4"><label class="form-label">Account Size ($)</label><input type="number" class="form-control" id="acc2" oninput="saveAcc(2);calc2()"></div>
                    <div class="col-md-4">
                        <label class="form-label">Risk %</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="risk2" value="0.5" oninput="calc2()">
                            <div class="input-group-text"><input type="checkbox" id="lock2" class="form-check-input me-2" onchange="toggleRisk(2)"> 3%</div>
                        </div>
                    </div>
                    <div class="col-md-4"><label class="form-label">Stoploss %</label><input type="number" class="form-control" id="sl2" value="0.6" step="0.1" oninput="calc2()"></div>
                    
                    <div class="col-md-3"><label class="form-label">TP1 (R) | %</label><div class="input-group"><input type="number" class="form-control" id="tp2_r1" value="1" oninput="calc2()"><input type="number" class="form-control" id="p2_1" value="25" oninput="balance(1,'p2_');calc2()"></div></div>
                    <div class="col-md-3"><label class="form-label">TP2 (R) | %</label><div class="input-group"><input type="number" class="form-control" id="tp2_r2" value="2" oninput="calc2()"><input type="number" class="form-control" id="p2_2" value="25" oninput="balance(2,'p2_');calc2()"></div></div>
                    <div class="col-md-3"><label class="form-label">TP3 (R) | %</label><div class="input-group"><input type="number" class="form-control" id="tp2_r3" value="3" oninput="calc2()"><input type="number" class="form-control" id="p2_3" value="25" oninput="balance(3,'p2_');calc2()"></div></div>
                    <div class="col-md-3"><label class="form-label">TP4 (R) | %</label><div class="input-group"><input type="number" class="form-control" id="tp2_r4" value="4" oninput="calc2()"><input type="number" class="form-control" id="p2_4" value="25" oninput="balance(4,'p2_');calc2()"></div></div>

                    <div class="col-md-12"><label class="form-label">Pair</label><select class="form-select" id="pair" onchange="calc2()"><option value="BTCUSDT">BTC</option><option value="ETHUSDT">ETH</option><option value="SOLUSDT">SOL</option></select></div>
                </div>
                <div class="mt-4">
                    <div class="res-row" style="border-left-color: var(--accent-red);"><span>Risk Amount:</span><b id="riskAmt2">$0.00</b></div>
                    <div id="tpContainer2"></div>
                    
                    <div class="total-profit-box">
                        <div class="profit-item">
                            <span class="profit-label">Est. Scaling Profit</span>
                            <span id="totalProfitText2" class="profit-value">$0.00</span>
                        </div>
                        <div class="profit-divider"></div>
                        <div class="profit-item">
                            <span class="profit-label">Scaled Acccount Growth</span>
                            <span id="accGrow2" class="profit-value">0.00%</span>
                        </div>
                    </div>

                    <div class="res-row pos"><span>Lot Size:</span><span><b id="lot2">0.0000</b><i class="fas fa-copy copy-btn" onclick="copyVal('lot2')"></i></span></div>
                    <div class="res-row pos" style="border-left-color: var(--accent-blue);"><span>Margin Required:</span><span><b id="margin2">$0.00</b><i class="fas fa-copy copy-btn" onclick="copyVal('margin2')"></i></span></div>
                    
                    <div class="api-status mt-3">
                        <span><i class="fas fa-circle-check" style="color:var(--accent-green)"></i> Bybit API Status: <b>Live</b></span>
                        <span id="apiTime">--:--:--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-center mt-4">
        <a href="https://www.flagcounter.me/details/gub">
            <img src="https://www.flagcounter.me/gub/" alt="Flag Counter" style="max-width:100%;height:auto;">
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let savedRisk = { 1: 1, 2: 0.5 };

    function saveNormal() {
        const data = {
            acc: document.getElementById('acc1').value,
            risk: document.getElementById('risk1').value,
            lev: document.getElementById('lev1').value,
            tps: [
                document.getElementById('tp1_r1').value, document.getElementById('tp1_r2').value,
                document.getElementById('tp1_r3').value, document.getElementById('tp1_r4').value
            ],
            partials: [
                document.getElementById('p1_1').value, document.getElementById('p1_2').value,
                document.getElementById('p1_3').value, document.getElementById('p1_4').value
            ]
        };
        localStorage.setItem('normal_calc_state', JSON.stringify(data));
    }

    function saveAcc(num) {
        localStorage.setItem('savedAccSize' + num, document.getElementById('acc' + num).value);
    }

    async function initializeApp() {
        await new Promise(resolve => setTimeout(resolve, 1000));

        const normalData = JSON.parse(localStorage.getItem('normal_calc_state'));
        if(normalData) {
            document.getElementById('acc1').value = normalData.acc;
            document.getElementById('risk1').value = normalData.risk;
            document.getElementById('lev1').value = normalData.lev;
            normalData.tps.forEach((val, i) => document.getElementById(`tp1_r${i+1}`).value = val);
            normalData.partials.forEach((val, i) => document.getElementById(`p1_${i+1}`).value = val);
        } else {
            document.getElementById('acc1').value = 1000;
            document.getElementById('risk1').value = 1;
            document.getElementById('lev1').value = 10;
            [2,3,4,5].forEach((val, i) => document.getElementById(`tp1_r${i+1}`).value = val);
            [25,25,25,25].forEach((val, i) => document.getElementById(`p1_${i+1}`).value = val);
        }

        document.getElementById('acc2').value = localStorage.getItem('savedAccSize2') || 5000;

        document.getElementById('loader').style.opacity = '0';
        setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
        calc1();
        calc2();
    }

    function toggleRisk(num) {
        const cb = document.getElementById('lock' + num);
        const input = document.getElementById('risk' + num);
        if (cb.checked) { savedRisk[num] = input.value; input.value = 3; } 
        else { input.value = savedRisk[num]; }
        num === 1 ? calc1() : calc2();
    }

    function balance(idx, pre) {
        let inputs = [1, 2, 3, 4].map(i => document.getElementById(pre + i));
        let total = 0;
        for(let i=0; i<idx; i++) total += parseFloat(inputs[i].value) || 0;
        if(total > 100) { inputs[idx-1].value = (100 - (total - parseFloat(inputs[idx-1].value))).toFixed(1); total = 100; }
        let remaining = 100 - total;
        let countLeft = 4 - idx;
        if(countLeft > 0) {
            let share = (remaining / countLeft).toFixed(1);
            for(let i=idx; i<4; i++) inputs[i].value = share;
        }
    }

    function calc1() {
        const acc = parseFloat(document.getElementById('acc1').value) || 0;
        const riskVal = parseFloat(document.getElementById('risk1').value) || 0;
        const sl = parseFloat(document.getElementById('sl1').value) || 0;
        const lev = parseFloat(document.getElementById('lev1').value) || 1;

        const riskAmt = (acc * riskVal) / 100;
        const posSize = sl > 0 ? (riskAmt * 100) / sl : 0;
        document.getElementById('riskAmt1').innerText = '$' + riskAmt.toFixed(2);
        document.getElementById('pos1').innerText = '$' + posSize.toFixed(2);
        document.getElementById('margin1').innerText = '$' + (posSize / lev).toFixed(2);

        let tpHTML = '', totalScaling = 0;
        for (let i = 1; i <= 4; i++) {
            let rMult = parseFloat(document.getElementById(`tp1_r${i}`).value) || 0;
            let pPct = parseFloat(document.getElementById(`p1_${i}`).value) || 0;
            let full = riskAmt * rMult;
            let scaled = full * (pPct / 100);
            totalScaling += scaled;
            tpHTML += `
                <div class="res-row tp">
                    <div>TP${i} 100% (<span class="highlight-r">${rMult}R</span>) | <b>$${full.toFixed(2)}</b></div>
                    <div class="scaling-box"><b>$${scaled.toFixed(2)}</b> | <span class="highlight-pct">${pPct}%</span></div>
                </div>`;
        }
        document.getElementById('tpContainer1').innerHTML = tpHTML;
        document.getElementById('totalProfitText1').innerText = `$${totalScaling.toFixed(2)}`;
        document.getElementById('accGrow1').innerText = `${((totalScaling/acc)*100).toFixed(2)}%`;
    }

    async function calc2() {
        const acc = parseFloat(document.getElementById('acc2').value) || 0;
        const riskVal = parseFloat(document.getElementById('risk2').value) || 0;
        const slP = parseFloat(document.getElementById('sl2').value) || 0;
        const pair = document.getElementById('pair').value;

        try {
            const res = await fetch(`https://api.bybit.com/v5/market/tickers?category=linear&symbol=${pair}`);
            const data = await res.json();
            const price = parseFloat(data.result.list[0].lastPrice);
            const riskAmt = (acc * riskVal) / 100;
            const slDist = price * (slP / 100);
            const lot = slDist > 0 ? (riskAmt / slDist) : 0;

            document.getElementById('riskAmt2').innerText = '$' + riskAmt.toFixed(2);
            document.getElementById('lot2').innerText = lot.toFixed(5);
            document.getElementById('margin2').innerText = '$' + ((lot * price) / 5).toFixed(2);
            document.getElementById('apiTime').innerText = new Date().toLocaleTimeString('nl-NL');

            let tpHTML = '', totalScaling = 0;
            for (let i = 1; i <= 4; i++) {
                let rMult = parseFloat(document.getElementById(`tp2_r${i}`).value) || 0;
                let pPct = parseFloat(document.getElementById(`p2_${i}`).value) || 0;
                let full = (slDist * rMult * lot);
                let scaled = full * (pPct / 100);
                totalScaling += scaled;
                tpHTML += `
                    <div class="res-row tp">
                        <div>TP${i} 100% (<span class="highlight-r">${rMult}R</span>) | <b>$${full.toFixed(2)}</b></div>
                        <div class="scaling-box"><b>$${scaled.toFixed(2)}</b> | <span class="highlight-pct">${pPct}%</span></div>
                    </div>`;
            }
            document.getElementById('tpContainer2').innerHTML = tpHTML;
            document.getElementById('totalProfitText2').innerText = `$${totalScaling.toFixed(2)}`;
            document.getElementById('accGrow2').innerText = `${((totalScaling/acc)*100).toFixed(2)}%`;
        } catch (e) { console.error("Bybit API Error"); }
    }

    function copyVal(id) {
        const text = document.getElementById(id).innerText.replace('$', '').replace(',', '');
        navigator.clipboard.writeText(text);
        const t = document.getElementById('copyToast'); t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
    }

    window.onload = initializeApp;
</script>
</body>
</html>
